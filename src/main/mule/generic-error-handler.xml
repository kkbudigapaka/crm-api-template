<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:email="http://www.mulesoft.org/schema/mule/email"
	xmlns:cloudhub="http://www.mulesoft.org/schema/mule/cloudhub"
	xmlns:sftp="http://www.mulesoft.org/schema/mule/sftp"
	xmlns:db="http://www.mulesoft.org/schema/mule/db"
	xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:tls="http://www.mulesoft.org/schema/mule/tls"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/tls http://www.mulesoft.org/schema/mule/tls/current/mule-tls.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/sftp http://www.mulesoft.org/schema/mule/sftp/current/mule-sftp.xsd
http://www.mulesoft.org/schema/mule/cloudhub http://www.mulesoft.org/schema/mule/cloudhub/current/mule-cloudhub.xsd
http://www.mulesoft.org/schema/mule/email http://www.mulesoft.org/schema/mule/email/current/mule-email.xsd">

	<error-handler name="global_error_handler">
		<on-error-propagate type="APIKIT:BAD_REQUEST"
			enableNotifications="true" logException="true">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="ac7ff2bd-c88e-49d0-90a6-44040bf0917d"
				message='In generic-global-error-handler, CorrelationID :  #[correlationId]' /> -->
			<set-variable
				value='${errorCodeMessage.apikit.badRequest.code}'
				doc:name="httpStatus" doc:id="2bcf392c-e50a-4e06-8888-f06164189064"
				variableName="httpStatus" />
			<set-variable
				value='${errorCodeMessage.apikit.badRequest.description}'
				doc:name="errorDescription"
				doc:id="c6c79e6f-00c5-4ddd-b7ef-6b06b028b701"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="464bba2d-fe07-4a1c-8a6b-7f3c8d062603"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate type="APIKIT:NOT_FOUND"
			enableNotifications="true" logException="true">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="28f61c25-55d8-4cf1-bab2-0d04bc9e9f3e"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.apikit.notFound.code}'
				doc:name="httpStatus" doc:id="d3b13aa7-76f0-4891-a261-1e3138a290f9"
				variableName="httpStatus" />
			<set-variable
				value='${errorCodeMessage.apikit.notFound.description}'
				doc:name="errorDescription"
				doc:id="9d8a2a12-aa25-4c58-8d0d-0dd3ea543e27"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="0c60e8dd-f188-4dd6-a8a8-f65ba098cd4b"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate
			type="APIKIT:METHOD_NOT_ALLOWED">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="8bb7e2fb-9192-4a60-8490-91b69aba3f12"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.apikit.methodNotAllowed.code}'
				doc:name="httpStatus" doc:id="b98be123-71bb-4b6f-9919-d40fa9f955e9"
				variableName="httpStatus" />
			<set-variable
				value='${errorCodeMessage.apikit.methodNotAllowed.description}'
				doc:name="errorDescription"
				doc:id="73f1922b-1528-4587-94b5-9b5360e7ea9b"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="8c970dfa-edde-4643-a087-a75282157cd2"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate type="APIKIT:NOT_ACCEPTABLE"
			enableNotifications="true" logException="true">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="ecdce9e8-2b6d-4a77-9b59-68ce83d0ada0"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.apikit.notAcceptable.code}'
				doc:name="httpStatus" doc:id="e462ca25-d2e7-4f44-9155-15e39961bbf9"
				variableName="httpStatus" />
			<set-variable
				value='${errorCodeMessage.apikit.notAcceptable.description}'
				doc:name="errorDescription"
				doc:id="55ed6cc9-e794-4522-bcbd-0a695e96e83f"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="8cc63664-0ba9-4b9c-9779-0e2e90cb2782"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate
			type="APIKIT:UNSUPPORTED_MEDIA_TYPE">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="cbc41f71-6aaa-4afb-ae5b-ab91c5db15d4"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.apikit.unsupportedMediaType.code}'
				doc:name="httpStatus" doc:id="710d6012-45c9-4cdd-a25c-14f540cd2e49"
				variableName="httpStatus" />
			<set-variable
				value='${errorCodeMessage.apikit.unsupportedMediaType.description}'
				doc:name="errorDescription"
				doc:id="acbbc41a-e3a7-4fc2-a07f-421b8dc81653"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="d16c6e56-0dc6-453a-bb0f-7b061bdcdf43"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate type="APIKIT:NOT_IMPLEMENTED"
			enableNotifications="true" logException="true">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="553ad6a3-739e-47ec-93a7-b99e790758d3"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.apikit.notImplemented.code}'
				doc:name="httpStatus" doc:id="4492b4a8-cb6c-49d6-a132-ad61479ce291"
				variableName="httpStatus" />
			<set-variable
				value='${errorCodeMessage.apikit.notImplemented.description}'
				doc:name="errorDescription"
				doc:id="60243489-01f6-450b-a853-13a35e2b4eb7"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="dc6d6aff-1dac-49f7-b4b8-c86c929998a3"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="e45e55a7-bedd-4e31-91b5-4eee9748c95c"
			type="HTTP:CONNECTIVITY">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="4d2e35e7-7aa1-4984-a5ff-590d99e2a66d"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler" doc:id="16194a19-b6a6-4fa4-8c47-633e7efaa340" 
				message='#["From parent flow" ++ (vars.apiLayer default "")]'/> <logger level="INFO" 
				doc:name="Entering Generic Error Handler" doc:id="d3026740-8e25-4191-a1e7-245d12f8a30e" 
				message="From Properties file #[p('globalErrorHandler.api-layer')]"/> -->
			<set-variable
				value='${errorCodeMessage.http.connectivity.code}'
				doc:name="httpStatus" doc:id="fa47a8e9-7ac8-40c3-b9f3-6508583af8f6"
				variableName="httpStatus" />
			<set-variable
				value="#[if(p('globalErrorHandler.api-layer') == &quot;experience&quot; or p('globalErrorHandler.api-layer') == &quot;exp&quot;)
p('errorCodeMessage.http.connectivity.description') default &quot;&quot;
 else
 error.description default &quot;&quot;]"
				doc:name="errorDescription"
				doc:id="a4095c06-6300-481a-8d56-3e475a190761"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="d085beee-3761-42bb-9b1d-a2cbb56279d0"
				name="common-error-sub-flow" />

		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="79669995-e617-4285-b66b-f537fa84bfee" type="HTTP:FORBIDDEN">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="3315c9d2-6703-40f1-b611-8b4e61848add"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.http.forbidden.code}'
				doc:name="httpStatus" doc:id="19320aaa-5336-4260-8ed7-aeab295b6c09"
				variableName="httpStatus" />
			<set-variable
				value="#[if(p('globalErrorHandler.api-layer') == &quot;experience&quot; or p('globalErrorHandler.api-layer') == &quot;exp&quot;)
p('errorCodeMessage.http.forbidden.description') default &quot;&quot;
 else
 error.description default &quot;&quot;]"
				doc:name="errorDescription"
				doc:id="7cd6133e-4fc0-41f3-b80b-ee05f8a42d6c"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="0bf657b7-febc-42e7-957f-f86a4123aeae"
				name="common-error-sub-flow" />

		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="9346fdeb-4375-4782-9511-0c7de14294ba"
			type="HTTP:SERVICE_UNAVAILABLE">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="b0d0a848-9d09-494e-bae2-3ebc858b6aea"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.http.serviceUnavailable.code}'
				doc:name="httpStatus" doc:id="e3cf629e-1a0e-430c-913b-930d84153580"
				variableName="httpStatus" />
			<set-variable
				value="#[if(p('globalErrorHandler.api-layer') == &quot;experience&quot; or p('globalErrorHandler.api-layer') == &quot;exp&quot;)
p('errorCodeMessage.http.serviceUnavailable.description') default &quot;&quot;
 else
 error.description default &quot;&quot;]"
				doc:name="errorDescription"
				doc:id="0b6b6fcb-bfa4-497d-a0ca-9e10cc213f60"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="363343dd-f40b-470e-8944-828408055f97"
				name="common-error-sub-flow" />

		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="b28484d6-bc6d-4bcf-a88d-14a2d3e79d5c" type="HTTP:TIMEOUT">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="125d432b-c9f1-4516-a7ef-afe00a973068"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.http.timeout.code}' doc:name="httpStatus"
				doc:id="29a32eda-a080-4ac3-95d6-87400821fb2a"
				variableName="httpStatus" />
			<set-variable
				value="#[if(p('globalErrorHandler.api-layer') == &quot;experience&quot; or p('globalErrorHandler.api-layer') == &quot;exp&quot;)
p('errorCodeMessage.http.timeout.description') default &quot;&quot;
 else
 error.description default &quot;&quot;]"
				doc:name="errorDescription"
				doc:id="335732b2-e9c7-474a-ad1d-d1b6f7ca067c"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="d674b66f-2c86-40b0-a2d6-b2c22659a5b1"
				name="common-error-sub-flow" />

		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="f5a1602b-35c6-4301-b0b8-201d40231d6a"
			type="HTTP:UNAUTHORIZED">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="f618a5aa-bad9-4a21-a09a-0a978f8191de"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='${errorCodeMessage.http.unauthorized.code}'
				doc:name="httpStatus" doc:id="7c680e6b-f742-414c-8f63-f97824ec1aea"
				variableName="httpStatus" />
			<set-variable
				value="#[if(p('globalErrorHandler.api-layer') == &quot;experience&quot; or p('globalErrorHandler.api-layer') == &quot;exp&quot;)
p('errorCodeMessage.http.unauthorized.description') default &quot;&quot;
 else
 error.description default &quot;&quot;]"
				doc:name="errorDescription"
				doc:id="5a20b32c-2885-4538-aa62-3f566b405df8"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="1d6d3fc2-c064-4bbe-823e-47407558c196"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="c7f8320e-c741-44d4-9bd2-1d0c4bb907f1" type="MULE:VALIDATION">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="1e492ff3-4a19-4640-a78e-047f99d5752e"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='#[attributes.statusCode default 500]' doc:name="httpStatus"
				doc:id="33d0a4ed-8d79-47d4-bee8-14772499400d"
				variableName="httpStatus" />
			<set-variable value="#[error.description]"
				doc:name="errorDescription"
				doc:id="99d426d5-be69-4230-b157-e5a39f893716"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="f06d256e-fdb5-460b-88d8-7bd30c373827"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="36eb5441-1462-4736-a1cd-4bf8c1b31090" type="EXPRESSION">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="64656748-8253-4138-bc85-5c06290856ef"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='#[attributes.statusCode default "500"]' doc:name="httpStatus"
				doc:id="be028c09-db82-4414-936b-a5b2e1a1ec9e"
				variableName="httpStatus" />
			<set-variable value="#[error.description]"
				doc:name="errorDescription"
				doc:id="0914e8d1-ab7d-4760-9d3e-b28bc0188466"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="6c089460-aee1-495f-b751-1bf213111e72"
				name="common-error-sub-flow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="On Error Propagate"
			doc:id="4bc4bf83-ab3c-435c-83b8-fc5345a8a6d9" type="ANY">
			<!-- <logger level="INFO" doc:name="Entering Generic Error Handler"
				doc:id="a59764f6-351e-434b-a594-860074036e17"
				message='"In generic-global-error-handler, CorrelationID :  #[correlationId]"' /> -->
			<set-variable
				value='#[attributes.statusCode default "500"]' doc:name="httpStatus"
				doc:id="f74116e2-5938-4a92-9f1b-e2d9a7ee0d27"
				variableName="httpStatus" />
			<set-variable value="#[error.description]"
				doc:name="errorDescription"
				doc:id="8dc00c16-27ce-49a3-ba59-43cfd19e7262"
				variableName="errorDescription" />
			<flow-ref doc:name="common-error-sub-flow"
				doc:id="498b6a25-8fcb-41a1-95da-43633160c83b"
				name="common-error-sub-flow" />
		</on-error-propagate>
	</error-handler>
    <sub-flow name="common-error-sub-flow"
		doc:id="a75257a7-93a8-4b00-bb47-affc7d0cffc2">
		<!-- <ee:transform doc:name="DW - Initiate Logging Variables"
			doc:id="a763cdc1-71c1-445c-8e2d-acf4a7e11961">
			<ee:message>
			</ee:message>
			<ee:variables>
				<ee:set-variable variableName="log_name"><![CDATA["generic-error-handler"]]></ee:set-variable>
				<ee:set-variable variableName="log_flowName"><![CDATA["common-error-sub-flow"]]></ee:set-variable>
				<ee:set-variable
					variableName="log_originatingApplication"><![CDATA["Generic Error Handler"]]></ee:set-variable>
				<ee:set-variable
					variableName="log_destinationApplication"><![CDATA["Generic Error Handler"]]></ee:set-variable>
			</ee:variables>
		</ee:transform> -->
		<!-- <logger level="ERROR" doc:name="Log Error"
			doc:id="a0c4832c-f090-4d70-bfcf-d58ae60535fd"
			message='"Error - HTTP Status Code: " #[vars.httpStatus] " Error Message Description : " #[vars.errorDescription]' /> -->
		<!-- <ee:transform doc:name="Error Response" doc:id="1abda29e-c587-43c4-8578-a603226ff9ba" 
			xsi:schemaLocation=" http://www.mulesoft.org/schema/mule/email http://www.mulesoft.org/schema/mule/email/current/mule-email.xsd 
			http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd 
			http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd"> 
			<ee:message> <ee:set-payload resource="dwTransformations/genericErrorResponse.dwl" 
			/> </ee:message> <ee:variables> </ee:variables> </ee:transform> -->
		
		<set-variable value='#[%dw 2.0
output application/json
---
{
	LogLevel: "ERROR",
	TracePoint: "ERROR RESPONSE",
	TransactionId: correlationId,
	Timestamp: now(),
	ErrorCode: vars.httpStatus,
    ErrorDescription: vars.errorDescription
}]' doc:name="loggingPayload" doc:id="0e22f176-e890-4322-b2b6-1bf5fedb837d" variableName="loggingPayload" />
        <set-payload value="#[vars.loggingPayload]" doc:name="Set loggingPayload" doc:id="1d0a5c28-c2ed-4a1a-87e3-aacdb5af4289" />
        <logger level="ERROR" doc:name="Exit Generic Error Handler"
			doc:id="07be7837-f77f-4611-be02-7b3f6e15ae33"
			message='"Exiting from generic-global-error-handler, loggingPayload :  #[vars.loggingPayload]"' />
	</sub-flow>
</mule>
